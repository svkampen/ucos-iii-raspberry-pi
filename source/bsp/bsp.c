/*
*********************************************************************************************************
*                                     MICIRUM BOARD SUPPORT PACKAGE
*
*                             (c) Copyright 2010; Micrium, Inc.; Weston, FL
*
*               All rights reserved.  Protected by international copyright laws.
*               Knowledge of the source code may NOT be used to develop a similar product.
*               Please help us continue to provide the Embedded community with the finest
*               software available.  Your honesty is greatly appreciated.
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*
*                                        BOARD SUPPORT PACKAGE
*
*                                            NXP LPC2923
*
* Filename      : bsp.c
* Version       : V1.00
* Programmer(s) : FF
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                             INCLUDE FILES
*********************************************************************************************************
*/

#define  BSP_MODULE
#include <bsp.h>
#include <uart.h>
#include <interrupts.h>
#include <gpio.h>
#include <includes.h>
#include <timer.h>

/*
*********************************************************************************************************
*                                      REGISTER & BIT FIELD DEFINES
*********************************************************************************************************
*/



/*
*********************************************************************************************************
*                                            LOCAL DEFINES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                           LOCAL CONSTANTS
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                          LOCAL DATA TYPES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                            LOCAL TABLES
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                       LOCAL GLOBAL VARIABLES
*********************************************************************************************************
*/

static bool BSP_LED_IsOn = false;

/*
*********************************************************************************************************
*                                      LOCAL FUNCTION PROTOTYPES
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                             REGISTERS
*********************************************************************************************************
*/


/*
*********************************************************************************************************
*                                            REGISTER BITS
*********************************************************************************************************
*/



/*
*********************************************************************************************************
*                                     LOCAL CONFIGURATION ERRORS
*********************************************************************************************************
*/

void BSP_LED_Init()
{
    GPIO_SetFunction(16, GPIO_FN_OUTPUT);
}

void BSP_LED_On()
{
    __dmb();
    GPIO_Set(16, GPIO_LED_ON);
    BSP_LED_IsOn = true;
    __dmb();
}

void BSP_LED_Off()
{
    __dmb();
    GPIO_Set(16, GPIO_LED_OFF);
    BSP_LED_IsOn = false;
    __dmb();
}

void BSP_LED_Toggle()
{
    if (BSP_LED_IsOn) BSP_LED_Off();
    else BSP_LED_On();
}

/*
*********************************************************************************************************
*                                             BSP_Init()
*
* Description : Initializes the Board Support Package
*
* Argument(s) : none.
*
* Return(s)   : none.
*
* Caller(s)   : Startup Code.
*
* Note(s)     : none.
*********************************************************************************************************
*/

void  BSP_Init (void)
{
    // uart_init(); already initialized early on for debugging
    BSP_LED_Init();
    int_init();
    timer_init(1000000/OS_CFG_TICK_RATE_HZ); // ticks/sec -> ms/tick
    int_enable_irqs();
}
